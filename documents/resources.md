# 資料

## e-Tax

重要なポイントとして、eTaxには税額を計算する機能はない。

[e-Tax仕様書](https://www.e-tax.nta.go.jp/shiyo/index.htm#anc05)に申告・申請の技術仕様がリストされている。LinuxでCabファイルを解凍するとファイル名が文字化けする。`unar`コマンドで解凍すると適切にデコードできる。または、`convmv`コマンドで変換する。ExcelファイルはLibreOfficeで編集可能。

* 起点となる手続IDのリストは存在していない。LucaSuite JPの対象は以下の手続
  * RHO0012「内国法人の確定申告（青色）」
  * RSH0040「消費税及び地方消費税申告（簡易課税・法人）」
* XMLタグ仕様は税目別の「XML構造設計書及び帳票フィールド仕様書」にある

### バージョン追跡

e-Tax仕様書のファイルは手続・帳票などの意味のある単位ではなく、改訂バージョン単位で分類されている。調査対象の手続や帳票のバージョンをあらかじめ特定しなくてはならない。  
ただしドキュメントから特定することはできない。eTaxソフトで申告ドラフトを作成すると`.xtx`からバージョンを確認できる。

* 手続のバージョンは、メジャーバージョンが西暦課税年度の下2ケタに対応している。24.0.0(ファイル表記は`Ver240x`)は2024年度の手続きに用いる仕様
  * 年度の判定基準は不明。4月〜3月の期間が年度であり、決算月の属する年度で決まるように見える
* IT部の対応バージョンを特定する方法については記載がない
* 各帳票のバージョンは、帳票の定義が変わることで上がる。年度ではない
  * 「07手続一覧等/02手続内帳票対応表」にリストされている手続のバージョンから特定する
  * 手続は年度ごとにバージョンアップするが、各帳票は旧年度とまったく同じものがある
  * メジャーバージョン間はファイル比較で違いを探せるが、マイナーバージョン間の変更点を読み取る手段はない

なお、バージョンの改訂意図を読み取る手段はない。税制改定じたいが必ずしもロジカルな帰結でない可能性があり、やむを得ない。

### 詳細

eTaxにはまっとうなソフトウェア設計が根本的に欠けており、紙の申告書を再現しようとしていることから生じるアノマリーが無数にある。

* 別表四の留保・社外流出の区分や別表五（一）の税務計算上の資産は、会計上は意味をなさず電子化に伴って廃止すべきもの
  * 紙の申告書をワークシートとして検算する目的の欄が多く、ソフトウェア計算する方式では機能しない
    * 適切に実装したソフトウェアが計算を誤ることはない。よって検算は廃止し、テストコードとして分離すべき
    * 益金・損金の算入範囲には解釈の余地があるが、それらにもとづく所得の集計計算には自由意思の余地がない。よって、税務所轄官庁が高品質なソフトウェアライブラリを開発提供し画一的に計算する方式がもっとも効果的
  * この計算は、国税庁が徴税余地を推定する諜報目的の資料だが、余地があるからといって徴税額が変えられるわけではない。
    * 別表四の加算・減算欄のように益金や損金の認識額を報告することは妥当。税務上の純資産といった計算上の概念は、納税者に計算させるのではなく役所の内部ツールで計算すべき
    * 現に別表四の留保・社外流出欄は、税額計算に用いることがない
  * 当面は、eTax仕様が無為に紙の申告書を再現し続ける方式が続くだろう。帳票フィールド仕様書に沿って計算するほかない


## eLTAX

重要なポイントとして、eLTAXには税額を計算する機能はない。

[税務ソフト仕様書](https://www.eltax.lta.go.jp/support/software/)に技術仕様がリストされている。Linuxでzipファイルを解凍するとファイル名が文字化けする。`unar`コマンドで解凍すると適切にデコードできる。ExcelファイルはLibreOfficeで編集可能。

* ファイルは手続・帳票などの意味のある単位ではなく、改訂バージョン単位で分類されている。調査対象の手続や帳票のバージョンをあらかじめ特定しなくてはならない
  * 「【別冊1】対象様式一覧」に帳票バージョンの有効期限がリストされている
* XMLタグ仕様はバージョン別の「【別冊1】様式タグ仕様書」にある

* 自治体別の税率は、総務省のサイトに掲載されている
  * [地方税に関する統計等](https://www.soumu.go.jp/main_sosiki/jichi_zeisei/czaisei/czaisei_seido/czei_shiryo_ichiran.html)

* 自治体コードなどはeLTAXサイトに掲載されている。総務省が配布しているコードとやや異なる
  * [eLTAX提出先](https://www.eltax.lta.go.jp/documents/03062)
  * [全国地方公共団体コード](https://www.soumu.go.jp/denshijiti/code.html)


## EDINET

eTaxのXBRLタクソノミは2012年の古いEDINETタクソノミを参照している

* [2012年版EDINETタクソノミ及び関連資料の公表について](https://www.fsa.go.jp/search/20120314.html)
  * 「勘定科目リスト」にeTax互換のタクソノミリストが掲載されている
